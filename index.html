<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mboa Skills</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #f0f2f5;
    }
    header {
      background-color: #fff;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-around;
      align-items: center;
      padding: 1rem;
      border-bottom: 1px solid #ddd;
      z-index: 9999;
    }
    header i {
      font-size: 1.4rem;
      color: #888;
      cursor: pointer;
    }
    header i.selected {
      color: #1877f2;
    }
    .tabcontent {
      display: none;
      padding: 6rem 1rem 1rem;
    }
    .tabcontent.active {
      display: block;
    }
    input, textarea, button, select {
      display: block;
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      background-color: #1877f2;
      color: white;
      font-weight: bold;
      cursor: pointer;
      border: none;
    }
    button:hover {
      background-color: #145ec1;
    }
    .post {
      background: white;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.1);
      padding: 1rem;
      margin-bottom: 1rem;
      width: 100%;
    }
    .post-header {
      display: flex;
      align-items: center;
      width: 100%;
    }
    .post-header img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 10px;
      object-fit: cover;
    }
    .post-content {
      margin-top: 10px;
    }
    .post video, .post .text-bg {
      width: 100%;
      border-radius: 10px;
      margin-top: 10px;
    }
    .text-bg {
      display: inline-block;
      padding: 0.5rem 1rem;
      background-color: #333;
      color: white;
      font-weight: bold;
      text-align: center;
      word-wrap: break-word;
      white-space: pre-wrap;
      border-radius: 10px;
      max-width: 90%;
    }
    .post-actions {
      margin-top: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .post-actions i {
      cursor: pointer;
    }
    .like.liked {
      color: #1877f2;
    }
    .post-actions button {
      background: none;
      border: none;
      color: #1877f2;
      cursor: pointer;
      font-weight: bold;
      padding: 0;
      margin-left: 10px;
    }
    textarea {
      border-radius: 15px;
      font-size: 15px;
    }
  </style>
</head>
<body>
  <header>
    <i class="fas fa-home tablinks selected" onclick="openTab(event, 'home')"></i>
    <i class="fas fa-film tablinks" onclick="openTab(event, 'video')"></i>
    <i class="fas fa-video tablinks" onclick="openTab(event, 'videoFeed')"></i>
     <i class="fas fa-plus tablinks" onclick="openTab(event, 'post')"></i>
    <i class="fas fa-search tablinks" onclick="openTab(event, 'search')"></i>
    <i class="fas fa-user tablinks" onclick="openTab(event, 'account')"></i>
  </header>

  <section id="home" class="tabcontent active">
             <div class="post-header">
                 <img id="homeProfilePhoto" src="https://via.placeholder.com/40" onclick="openTab(event, 'feedme')" />
          <p id="authStatus"></p>
           <i class="fas fa-plus tablinks" onclick="openTab(event, 'post')"></i>

        </div>

    <div id="feed"></div>
  </section>

  <section id="video" class="tabcontent">
    <h3>Booster une publication</h3>
    <select id="selectPost"></select>
    <select id="boostViews">
      <option value="1000">1000 vues</option>
      <option value="2000">2000 vues</option>
      <option value="5000">5000 vues</option>
    </select>
    <button onclick="boostPost()">Booster</button>
  </section>

  <section id="post" class="tabcontent">
    <h3>Créer une publication</h3>
    <textarea id="postText" placeholder="Exprimez-vous..."></textarea>
    <input type="color" id="bgColor" value="#1877f2" />
    <hr>
    <input type="text" id="videoTitle" placeholder="Titre de la vidéo" />
    <input type="file" id="videoFile" accept="video/*" />
    <button onclick="publishPost()">Publier</button>
    <p id="status"></p>
  </section>

  <section id="account" class="tabcontent">
    <h3>Connexion</h3>
    <button onclick="signInWithGoogle()"><i class="fab fa-google"></i> Connexion/inscription Google</button>
    <hr>
    <button onclick="signOutUser()">Se déconnecter</button>
    <b id="authStatus"></b>
  </section>

  <section id="feedme" class="tabcontent">
    <h3>Mes publications:</h3>
                 <div class="post-header">
                    <img id="homeProfilePhoto" src="https://via.placeholder.com/40" onclick="openTab(event, 'feedme')" />
           <label for="profilePhotoInput" title="Changer la photo de profil">
  <i class="fas fa-plus" style="cursor:pointer;"></i>
</label>
<input type="file" id="profilePhotoInput" accept="image/*" style="display:none" />

        </div>
    <div id="myFeed"></div>
  </section>

  <section id="search" class="tabcontent">
    <h3>Rechercher un utilisateur</h3>
    <input type="text" id="searchUserInput" placeholder="Nom ou email de l'utilisateur">
    <button onclick="searchUser()">Rechercher</button>
    <div id="searchResults"></div>
  </section>
<section id="userFeedSection" class="tabcontent">
  <h3 id="userFeedTitle">Publications de l'utilisateur</h3>
  <div id="userFeed"></div>
</section>
<section id="videoFeed" class="tabcontent">
  <h3>Publications avec vidéos</h3>
  <div id="videoFeedContent"></div>
</section>
  <script type="module">
 import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
import {
  getAuth, onAuthStateChanged, signInWithPopup, signOut,
  GoogleAuthProvider
} from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
import {
  getFirestore, collection, addDoc, onSnapshot, query, orderBy,
  updateDoc, doc, increment, getDocs, where, serverTimestamp
} from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";
import {
  getStorage, ref, uploadBytesResumable, getDownloadURL
} from "https://www.gstatic.com/firebasejs/11.9.1/firebase-storage.js";

const firebaseConfig = {
  apiKey: "AIzaSyClSjd2LrIQpaJoVWO32vFRx7I9cvmDgBo",
  authDomain: "mboa-ec602.firebaseapp.com",
  projectId: "mboa-ec602",
  storageBucket: "mboa-ec602.appspot.com",
  messagingSenderId: "498505132403",
  appId: "1:498505132403:web:eb46547745f8d1a77b3d06"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);
const provider = new GoogleAuthProvider();

let currentUser = null;
let likedPosts = new Set();

onAuthStateChanged(auth, async (user) => {
  currentUser = user;
  if (user.photoURL) {
  console.log("Photo actuelle :", user.photoURL);
}
if (user.photoURL) {
  const photoElem = document.getElementById("homeProfilePhoto");
  if (photoElem) {
    photoElem.src = user.photoURL;
  }
}
  if (user) {
    document.getElementById("authStatus").innerText = ` ${user.displayName || user.email}`;
    await loadLikedPosts();
    await loadBoostablePosts();
  } else {
    likedPosts.clear();
    document.getElementById("authStatus").innerText = "";
    document.getElementById("selectPost").innerHTML = "";
  }
  renderFeed();
  renderMyFeed();
});
const profilePhotoInput = document.getElementById("profilePhotoInput");

profilePhotoInput.addEventListener("change", async (event) => {
  const file = event.target.files[0];
  if (!file) return;

  if (!currentUser) {
    alert("Connectez-vous d'abord.");
    return;
  }

  const fileRef = ref(storage, `profile_photos/${currentUser.uid}_${Date.now()}`);
  const uploadTask = uploadBytesResumable(fileRef, file);

  uploadTask.on("state_changed", null, (error) => {
    console.error("Erreur d'envoi de l'image :", error);
    alert("Échec de l'envoi de la photo.");
  }, async () => {
    const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);

    try {
      // Met à jour la photo dans le profil Firebase Auth
      await currentUser.updateProfile({
        photoURL: downloadURL
      });

      alert("Photo de profil mise à jour !");
      location.reload(); // Recharge la page pour que la nouvelle photo s’affiche
    } catch (error) {
      console.error("Erreur de mise à jour du profil :", error);
      alert("Erreur lors de la mise à jour de la photo.");
    }
  });
});
window.signInWithGoogle = async function () {
  try {
    const result = await signInWithPopup(auth, provider);
    const user = result.user;
    document.getElementById("authStatus").innerText = ` ${user.displayName || user.email}`;
  } catch (error) {
    console.error("Erreur Google Auth:", error);
    document.getElementById("authStatus").innerText = error.message;
  }
};

window.signOutUser = async function () {
  await signOut(auth);
  document.getElementById("authStatus").innerText = "Déconnecté.";
  likedPosts.clear();
  document.getElementById("selectPost").innerHTML = "";
  renderFeed();
  renderMyFeed();
};

window.publishPost = async function () {
  if (!currentUser) return alert("Connectez-vous pour publier.");
  const text = document.getElementById("postText").value.trim();
  const bgColor = document.getElementById("bgColor").value;
  const video = document.getElementById("videoFile").files[0];
  const videoTitle = document.getElementById("videoTitle").value.trim();
  if (!text && !video) return alert("Ajoutez un texte ou une vidéo.");

  document.getElementById("status").innerText = "Publication en cours...";

  const postData = {
    userEmail: currentUser.email,
    userId: currentUser.uid,
    userName: currentUser.displayName || currentUser.email,
    userPhoto: currentUser.photoURL || "https://via.placeholder.com/40",
    text,
    bgColor,
    videoUrl: null,
    videoTitle,
    views: 0,
    likes: 0,
    createdAt: serverTimestamp(),
    boosted: 0
  };

  if (video) {
    const refV = ref(storage, `videos/${Date.now()}_${video.name}`);
    const uploadTask = uploadBytesResumable(refV, video);

    uploadTask.on(
      "state_changed",
      (snapshot) => {
        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
        document.getElementById("status").innerText = `Téléchargement : ${Math.floor(progress)}%`;
      },
      (error) => {
        console.error("Erreur upload :", error);
        alert("Erreur pendant l'envoi de la vidéo.");
        document.getElementById("status").innerText = "";
      },
      async () => {
        postData.videoUrl = await getDownloadURL(uploadTask.snapshot.ref);
        await addDoc(collection(db, "posts"), postData);
        document.getElementById("status").innerText = "Publication réussie.";
        document.getElementById("postText").value = "";
        document.getElementById("videoFile").value = "";
        document.getElementById("videoTitle").value = "";
      }
    );
  } else {
    await addDoc(collection(db, "posts"), postData);
    document.getElementById("status").innerText = "Publication réussie.";
    document.getElementById("postText").value = "";
  }
};

function escapeHtml(text) {
  const div = document.createElement("div");
  div.textContent = text;
  return div.innerHTML;
}

function renderFeed() {
  const feed = document.getElementById("feed");
  if (window.unsubscribePosts) window.unsubscribePosts();

  const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
  window.unsubscribePosts = onSnapshot(q, (snapshot) => {
    feed.innerHTML = "";
    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      const postId = docSnap.id;
      const isLiked = likedPosts.has(postId);

      const postDiv = document.createElement("div");
      postDiv.className = "post";

      let html = `
        <div class="post-header">
          <img src="${escapeHtml(post.userPhoto || '')}" />
<strong class="user-link" onclick="showUserFeed('${post.userId}', '${escapeHtml(post.userName || "Anonyme")}')">
  ${escapeHtml(post.userName || "Anonyme")}
</strong>
        </div>
        <div class="post-content">
      `;
      if (post.text) {
        html += `<div class="text-bg" style="background:${post.bgColor || '#1877f2'}">${escapeHtml(post.text)}</div>`;
      }
      if (post.videoTitle) {
        html += `<h4>${escapeHtml(post.videoTitle)}</h4>`;
      }
      if (post.videoUrl) {
        html += `<video src="${post.videoUrl}" controls muted onplay="recordView('${postId}')"></video>`;
      }
      html += `
        </div>
        <div class="post-actions">
          <i class="fa fa-thumbs-up like${isLiked ? ' liked' : ''}" onclick="toggleLike('${postId}')"></i>
          <span id="likes-${postId}">${post.likes || 0} j'aime</span>
          <span>${post.views || 0} vues</span>
        </div>
      `;

      postDiv.innerHTML = html;
      feed.appendChild(postDiv);
    });
  });
}

function renderMyFeed() {
  const container = document.getElementById("myFeed");
  if (!currentUser) {
    container.innerHTML = "<p>Veuillez vous connecter pour voir vos publications.</p>";
    return;
  }

  const q = query(
    collection(db, "posts"),
    where("userId", "==", currentUser.uid),
    orderBy("createdAt", "desc")
  );

  onSnapshot(q, (snapshot) => {
    container.innerHTML = "";
    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      const postId = docSnap.id;
      const isLiked = likedPosts.has(postId);

      const div = document.createElement("div");
      div.className = "post";

      let html = `
        <div class="post-header">
          <img src="${escapeHtml(post.userPhoto || '')}" />
<strong class="user-link" onclick="showUserFeed('${post.userId}', '${escapeHtml(post.userName || "Anonyme")}')">
  ${escapeHtml(post.userName || "Anonyme")}
</strong>        </div>
        <div class="post-content">
      `;
      if (post.text) {
        html += `<div class="text-bg" style="background:${post.bgColor || '#1877f2'}">${escapeHtml(post.text)}</div>`;
      }
      if (post.videoTitle) {
        html += `<h4>${escapeHtml(post.videoTitle)}</h4>`;
      }
      if (post.videoUrl) {
        html += `<video src="${post.videoUrl}" controls muted onplay="recordView('${postId}')"></video>`;
      }
      html += `
        </div>
        <div class="post-actions">
          <i class="fa fa-thumbs-up like${isLiked ? ' liked' : ''}" onclick="toggleLike('${postId}')"></i>
          <span id="likes-${postId}">${post.likes || 0} j'aime</span>
          <span>${post.views || 0} vues</span>
        </div>
      `;

      div.innerHTML = html;
      container.appendChild(div);
    });
  });
}

window.recordView = async function (postId) {
  try {
    const refPost = doc(db, "posts", postId);
    await updateDoc(refPost, { views: increment(1) });
  } catch (e) {
    console.error("Erreur recordView:", e);
  }
};

async function loadLikedPosts() {
  if (!currentUser) return;
  likedPosts.clear();
  try {
    const postsSnapshot = await getDocs(collection(db, "posts"));
    for (const postDoc of postsSnapshot.docs) {
      const likesSubcol = collection(db, `posts/${postDoc.id}/likes`);
      const userLikeQuery = query(likesSubcol, where("user", "==", currentUser.uid));
      const userLikesSnapshot = await getDocs(userLikeQuery);
      if (!userLikesSnapshot.empty) {
        likedPosts.add(postDoc.id);
      }
    }
  } catch (e) {
    console.error("Erreur loadLikedPosts:", e);
  }
}

window.toggleLike = async function (postId) {
  if (!currentUser) return alert("Connectez-vous pour liker.");

  try {
    const likeRef = doc(db, "posts", postId);
    const likesSubcol = collection(db, `posts/${postId}/likes`);
    const userLikeQuery = query(likesSubcol, where("user", "==", currentUser.uid));
    const userLikesSnapshot = await getDocs(userLikeQuery);

    if (userLikesSnapshot.empty) {
      await addDoc(likesSubcol, { user: currentUser.uid });
      await updateDoc(likeRef, { likes: increment(1) });
      likedPosts.add(postId);
    } else {
      for (const d of userLikesSnapshot.docs) {
        await d.ref.delete();
      }
      await updateDoc(likeRef, { likes: increment(-1) });
      likedPosts.delete(postId);
    }

    renderFeed();
    renderMyFeed();
  } catch (error) {
    console.error("Erreur toggleLike:", error);
  }
};

window.boostPost = async function () {
  if (!currentUser) return alert("Connectez-vous pour booster une publication.");

  const postId = document.getElementById("selectPost").value;
  const viewsToAdd = parseInt(document.getElementById("boostViews").value);
  if (!postId) return alert("Veuillez sélectionner une publication.");

  try {
    const refPost = doc(db, "posts", postId);
    await updateDoc(refPost, { views: increment(viewsToAdd), boosted: increment(viewsToAdd) });
    alert("Publication boostée avec succès.");
  } catch (e) {
    alert("Erreur lors du boost : " + e.message);
  }
};

async function loadBoostablePosts() {
  if (!currentUser) return;
  const now = new Date();
  const sevenDaysAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
  const select = document.getElementById("selectPost");
  select.innerHTML = "";

  try {
    const postsSnapshot = await getDocs(query(
      collection(db, "posts"),
      where("userId", "==", currentUser.uid),
      orderBy("createdAt", "desc")
    ));

    postsSnapshot.forEach(docSnap => {
      const post = docSnap.data();
      const created = post.createdAt?.toDate?.();
      if (created && created >= sevenDaysAgo) {
        const option = document.createElement("option");
        option.value = docSnap.id;
        option.textContent = post.text?.slice(0, 50) || post.videoTitle || "(vidéo)";
        select.appendChild(option);
      }
    });
  } catch (e) {
    console.error("Erreur loadBoostablePosts:", e);
  }
}

window.searchUser = async function () {
  const queryInput = document.getElementById("searchUserInput").value.trim().toLowerCase();
  const resultsDiv = document.getElementById("searchResults");
  if (!queryInput) {
    resultsDiv.innerHTML = "<p>Veuillez entrer un nom ou un email.</p>";
    return;
  }
  resultsDiv.innerHTML = "<p>Recherche en cours...</p>";

  try {
    const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
    const snapshot = await getDocs(q);

    const matchedPosts = [];

    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      if (
        (post.userName || "").toLowerCase().includes(queryInput) ||
        (post.userEmail || "").toLowerCase().includes(queryInput)
      ) {
        matchedPosts.push({ id: docSnap.id, data: post });
      }
    });

    if (matchedPosts.length === 0) {
      resultsDiv.innerHTML = "<p>Aucun utilisateur trouvé.</p>";
      return;
    }

    resultsDiv.innerHTML = "";
    matchedPosts.forEach(({ id, data }) => {
      const isLiked = likedPosts.has(id);
      const div = document.createElement("div");
      div.className = "post";

      let html = `
        <div class="post-header">
          <img src="${escapeHtml(data.userPhoto || '')}" />
<strong class="user-link" onclick="showUserFeed('${post.userId}')">
  ${escapeHtml(post.userName || "Anonyme")}
</strong>        </div>
        <div class="post-content">
      `;
      if (data.text) {
        html += `<div class="text-bg" style="background:${data.bgColor || '#1877f2'}">${escapeHtml(data.text)}</div>`;
      }
      if (data.videoTitle) {
        html += `<h4>${escapeHtml(data.videoTitle)}</h4>`;
      }
      if (data.videoUrl) {
        html += `<video src="${data.videoUrl}" controls muted onplay="recordView('${id}')"></video>`;
      }
      html += `
        </div>
        <div class="post-actions">
          <i class="fa fa-thumbs-up like${isLiked ? ' liked' : ''}" onclick="toggleLike('${id}')"></i>
          <span id="likes-${id}">${data.likes || 0} j'aime</span>
          <span>${data.views || 0} vues</span>
        </div>
      `;

      div.innerHTML = html;
      resultsDiv.appendChild(div);
    });
  } catch (e) {
    console.error("Erreur recherche :", e);
    resultsDiv.innerHTML = "<p>Erreur lors de la recherche.</p>";
  }
};
window.showUserFeed = function(userId, userName) {
  document.getElementById("userFeed").innerHTML = "<p>Chargement...</p>";
  document.getElementById("userFeedTitle").innerText = `Publications de ${userName}`;
  openTab(null, 'userFeedSection');

  const q = query(
    collection(db, "posts"),
    where("userId", "==", userId),
    orderBy("createdAt", "desc")
  );

  onSnapshot(q, (snapshot) => {
    const container = document.getElementById("userFeed");
    container.innerHTML = "";
    if (snapshot.empty) {
      container.innerHTML = "<p>Aucune publication.</p>";
      return;
    }

    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      const postId = docSnap.id;
      const isLiked = likedPosts.has(postId);

      const div = document.createElement("div");
      div.className = "post";

      let html = `
        <div class="post-header">
          <img src="${escapeHtml(post.userPhoto || '')}" alt="Avatar" />
          <strong class="user-link" onclick="showUserFeed('${post.userId}', '${escapeHtml(post.userName || "Utilisateur")}')">
            ${escapeHtml(post.userName || "Utilisateur")}
          </strong>
        </div>
        <div class="post-content">
      `;
      if (post.text) {
        html += `<div class="text-bg" style="background:${post.bgColor || '#1877f2'}">${escapeHtml(post.text)}</div>`;
      }
      if (post.videoTitle) {
        html += `<h4>${escapeHtml(post.videoTitle)}</h4>`;
      }
      if (post.videoUrl) {
        html += `<video src="${post.videoUrl}" controls muted onplay="recordView('${postId}')"></video>`;
      }
      html += `
        </div>
        <div class="post-actions">
          <i class="fa fa-thumbs-up like${isLiked ? ' liked' : ''}" onclick="toggleLike('${postId}')"></i>
          <span id="likes-${postId}">${post.likes || 0} j'aime</span>
          <span>${post.views || 0} vues</span>
        </div>
      `;

      div.innerHTML = html;
      container.appendChild(div);
    });
  });
};
function renderVideoFeed() {
  const container = document.getElementById("videoFeedContent");
  container.innerHTML = "<p>Chargement...</p>";

  const q = query(collection(db, "posts"), orderBy("createdAt", "desc"));
  getDocs(q).then(snapshot => {
    container.innerHTML = "";
    snapshot.forEach(docSnap => {
      const post = docSnap.data();
      const postId = docSnap.id;

      if (!post.videoUrl) return; // On ignore les posts sans vidéo
      const isLiked = likedPosts.has(postId);

      const div = document.createElement("div");
      div.className = "post";

      let html = `
        <div class="post-header">
          <img src="${escapeHtml(post.userPhoto || '')}" />
          <strong class="user-link" onclick="showUserFeed('${post.userId}', '${escapeHtml(post.userName || "Utilisateur")}')">
            ${escapeHtml(post.userName || "Utilisateur")}
          </strong>
        </div>
        <div class="post-content">
          ${post.videoTitle ? `<h4>${escapeHtml(post.videoTitle)}</h4>` : ""}
          <video src="${post.videoUrl}" controls muted onplay="recordView('${postId}')"></video>
        </div>
        <div class="post-actions">
          <i class="fa fa-thumbs-up like${isLiked ? ' liked' : ''}" onclick="toggleLike('${postId}')"></i>
          <span id="likes-${postId}">${post.likes || 0} j'aime</span>
          <span>${post.views || 0} vues</span>
        </div>
      `;

      div.innerHTML = html;
      container.appendChild(div);
    });

    if (!container.innerHTML) container.innerHTML = "<p>Aucune vidéo trouvée.</p>";
  }).catch(e => {
    console.error("Erreur vidéo feed :", e);
    container.innerHTML = "<p>Erreur lors du chargement des vidéos.</p>";
  });
}
window.openTab = function (evt, tabName) {
  // Masquer toutes les sections
  document.querySelectorAll(".tabcontent").forEach(tab => tab.classList.remove("active"));
  // Afficher la section sélectionnée
  document.getElementById(tabName).classList.add("active");
  
  // Mettre à jour les liens
  document.querySelectorAll(".tablinks").forEach(icon => icon.classList.remove("selected"));
  if (evt && evt.currentTarget) evt.currentTarget.classList.add("selected");

  // Mettre à jour l'historique de navigation
  window.history.pushState({ tab: tabName }, tabName, "#" + tabName);
};

window.addEventListener("popstate", function(event) {
  if (event.state && event.state.tab) {
    // Masquer toutes les sections
    document.querySelectorAll(".tabcontent").forEach(tab => tab.classList.remove("active"));
    // Afficher la section sélectionnée
    document.getElementById(event.state.tab).classList.add("active");

    // Mettre à jour les liens
    document.querySelectorAll(".tablinks").forEach(icon => icon.classList.remove("selected"));
    const selectedLink = document.querySelector(`[onclick*="${event.state.tab}"]`);
    if (selectedLink) selectedLink.classList.add("selected");
  } else if (window.location.hash) {
    const tabName = window.location.hash.substring(1);
    // Masquer toutes les sections
    document.querySelectorAll(".tabcontent").forEach(tab => tab.classList.remove("active"));
    // Afficher la section sélectionnée
    document.getElementById(tabName).classList.add("active");

    // Mettre à jour les liens
    document.querySelectorAll(".tablinks").forEach(icon => icon.classList.remove("selected"));
    const selectedLink = document.querySelector(`[onclick*="${tabName}"]`);
    if (selectedLink) selectedLink.classList.add("selected");
  }
});

// Gérer le chargement initial de la page
if (window.location.hash) {
  const tabName = window.location.hash.substring(1);
  // Masquer toutes les sections
  document.querySelectorAll(".tabcontent").forEach(tab => tab.classList.remove("active"));
  // Afficher la section sélectionnée
  document.getElementById(tabName).classList.add("active");

  // Mettre à jour les liens
  document.querySelectorAll(".tablinks").forEach(icon => icon.classList.remove("selected"));
  const selectedLink = document.querySelector(`[onclick*="${tabName}"]`);
  if (selectedLink) selectedLink.classList.add("selected");
}

</script>
</body>
</html>